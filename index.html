<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Comune di Piacenza Roleplay - Login</title>
    <link rel="stylesheet" href="login.css">
</head>
<body>
    <div class="container">
        <div class="login-box">
            <div class="header">
                <h1>Benvenuto da</h1>
                <h2>Comune di Piacenza Roleplay</h2>
                <div class="logo-placeholder">
                    <img id="logo" src="logo.png" alt="Logo Comune di Piacenza" onerror="this.style.display='none'; this.nextElementSibling.style.display='block';">
                    <div class="logo-text" style="display: none;">LOGO</div>
                </div>
            </div>

            <div class="links-container">
                <a href="https://discord.gg/tuoserver" target="_blank" class="link-btn discord">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M20.317 4.37a19.791 19.791 0 0 0-4.885-1.515a.074.074 0 0 0-.079.037c-.21.375-.444.864-.608 1.25a18.27 18.27 0 0 0-5.487 0a12.64 12.64 0 0 0-.617-1.25a.077.077 0 0 0-.079-.037A19.736 19.736 0 0 0 3.677 4.37a.07.07 0 0 0-.032.027C.533 9.046-.32 13.58.099 18.057a.082.082 0 0 0 .031.057a19.9 19.9 0 0 0 5.993 3.03a.078.078 0 0 0 .084-.028a14.09 14.09 0 0 0 1.226-1.994a.076.076 0 0 0-.041-.106a13.107 13.107 0 0 1-1.872-.892a.077.077 0 0 1-.008-.128a10.2 10.2 0 0 0 .372-.292a.074.074 0 0 1 .077-.01c3.928 1.793 8.18 1.793 12.062 0a.074.074 0 0 1 .078.01c.12.098.246.198.373.292a.077.077 0 0 1-.006.127a12.299 12.299 0 0 1-1.873.892a.077.077 0 0 0-.041.107c.36.698.772 1.362 1.225 1.993a.076.076 0 0 0 .084.028a19.839 19.839 0 0 0 6.002-3.03a.077.077 0 0 0 .032-.054c.5-5.177-.838-9.674-3.549-13.66a.061.061 0 0 0-.031-.03zM8.02 15.33c-1.183 0-2.157-1.085-2.157-2.419c0-1.333.956-2.419 2.157-2.419c1.21 0 2.176 1.096 2.157 2.42c0 1.333-.956 2.418-2.157 2.418zm7.975 0c-1.183 0-2.157-1.085-2.157-2.419c0-1.333.955-2.419 2.157-2.419c1.21 0 2.176 1.096 2.157 2.42c0 1.333-.946 2.418-2.157 2.418z"/>
                    </svg>
                    Server Discord
                </a>
                <a href="https://www.roblox.com/groups/tuogruppo" target="_blank" class="link-btn roblox">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M18.926 23.998L0.002 18.521 5.075 0.002l18.924 5.477-5.073 18.519zM9.233 13.499l3.722 1.077 1.077-3.721-3.722-1.078-1.077 3.722z"/>
                    </svg>
                    Server Roblox
                </a>
            </div>

            <!-- Tabs -->
            <div class="tabs">
                <button class="tab active" onclick="showTab('login')">Login</button>
                <button class="tab" onclick="showTab('register')">Registrazione</button>
                <button class="tab" onclick="showTab('admin')">Amministratore</button>
            </div>

            <!-- Form Login -->
            <form id="loginForm" class="form-container active">
                <div class="input-group">
                    <label for="loginUsername">Nome Utente</label>
                    <input type="text" id="loginUsername" required>
                </div>
                <div class="input-group">
                    <label for="loginPassword">Password</label>
                    <input type="password" id="loginPassword" required>
                </div>
                <button type="submit" class="submit-btn">Accedi</button>
            </form>

            <!-- Form Registrazione -->
            <form id="registerForm" class="form-container">
                <div class="input-group">
                    <label for="regUsername">Nome Utente</label>
                    <input type="text" id="regUsername" required>
                </div>
                <div class="input-group">
                    <label for="regEmail">Email</label>
                    <input type="email" id="regEmail" required>
                </div>
                <div class="input-group">
                    <label for="regPassword">Password</label>
                    <input type="password" id="regPassword" required>
                </div>
                <div class="input-group">
                    <label for="regPasswordConfirm">Conferma Password</label>
                    <input type="password" id="regPasswordConfirm" required>
                </div>
                <button type="submit" class="submit-btn">Registrati</button>
            </form>

            <!-- Form Admin -->
            <form id="adminForm" class="form-container">
                <div class="input-group">
                    <label for="adminUsername">Nome Utente</label>
                    <input type="text" id="adminUsername" required>
                </div>
                <div class="input-group">
                    <label for="adminEmail">Email Amministratore</label>
                    <input type="email" id="adminEmail" placeholder="admin@piacenzarp.it" required>
                </div>
                <div class="input-group">
                    <label for="adminPassword">Password</label>
                    <input type="password" id="adminPassword" required>
                </div>
                <button type="submit" class="submit-btn admin-btn">Accedi come Admin</button>
            </form>
        </div>
    </div>

    <!-- Modal Codice Autenticazione -->
    <div id="authModal" class="modal">
        <div class="modal-content">
            <h3>Codice di Autenticazione</h3>
            <p>Inserisci il codice a 6 cifre inviato alla tua email</p>
            <form id="authForm">
                <div class="input-group">
                    <input type="text" id="authCode" maxlength="6" placeholder="000000" required>
                </div>
                <button type="submit" class="submit-btn">Verifica</button>
                <button type="button" class="cancel-btn" onclick="closeAuthModal()">Annulla</button>
            </form>
        </div>
    </div>

    <script>
        let currentTab = 'login';
        let userData = {};

        function showTab(tab) {
            currentTab = tab;
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.form-container').forEach(f => f.classList.remove('active'));
            
            event.target.classList.add('active');
            document.getElementById(tab + 'Form').classList.add('active');
        }

        document.getElementById('loginForm').addEventListener('submit', function(e) {
            e.preventDefault();
            userData = {
                username: document.getElementById('loginUsername').value,
                isAdmin: false,
                type: 'login'
            };
            showAuthModal();
        });

        document.getElementById('registerForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const password = document.getElementById('regPassword').value;
            const confirmPassword = document.getElementById('regPasswordConfirm').value;
            
            if (password !== confirmPassword) {
                alert('Le password non coincidono!');
                return;
            }
            
            userData = {
                username: document.getElementById('regUsername').value,
                email: document.getElementById('regEmail').value,
                password: password,
                isAdmin: false,
                type: 'register'
            };
            
            // Salva i dati di registrazione
            let users = JSON.parse(localStorage.getItem('registeredUsers') || '[]');
            users.push(userData);
            localStorage.setItem('registeredUsers', JSON.stringify(users));
            
            showAuthModal();
        });

        document.getElementById('adminForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const email = document.getElementById('adminEmail').value;
            
            // Verifica email amministratore
            if (email !== 'admin@piacenzarp.it') {
                alert('Email amministratore non valida!');
                return;
            }
            
            userData = {
                username: document.getElementById('adminUsername').value,
                email: email,
                isAdmin: true,
                type: 'admin'
            };
            showAuthModal();
        });

        function showAuthModal() {
            document.getElementById('authModal').style.display = 'flex';
        }

        function closeAuthModal() {
            document.getElementById('authModal').style.display = 'none';
            document.getElementById('authCode').value = '';
        }

        document.getElementById('authForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const code = document.getElementById('authCode').value;
            
            if (code.length === 6) {
                // Salva i dati di sessione
                sessionStorage.setItem('currentUser', JSON.stringify(userData));
                sessionStorage.setItem('isLoggedIn', 'true');
                
                // Reindirizza alla home
                window.location.href = 'home.html';
            } else {
                alert('Inserisci un codice valido a 6 cifre');
            }
        });

        // Impedisce accesso alla home se non loggato
        window.addEventListener('load', function() {
            const isLoggedIn = sessionStorage.getItem('isLoggedIn');
            if (isLoggedIn === 'true') {
                window.location.href = 'home.html';
            }
        });
    </script>
</body>
</html>